function gotoApp(){setTimeout(function(){authReady()})}function isCacheUseful(t){var e=storage.local.get(t);return e?!0:!1}function getOpenidByCode(t,e){Http.post(URLObj.weixinapiURL,{type:"getOpenidByCode",uname:URLObj.Config.uname,param:t}).then(function(t){0!==t.code?Utils.toast(t.message):e(t)})["catch"](function(t){Utils.toast(JSON.stringify(t))})}function requireOpenIdFromWeb(t){var e=Utils.getQueryString("openid");if(e)return storage.local.set("_openid",e),void t();var i=Utils.getQueryString("code"),n=storage.local.get("_code");return debug("code:"+i),i?void(n!==i?(storage.local.remove("_openid"),debug("requireOpenId..."),getOpenidByCode(i,function(e){var n=JSON.parse(e.message),o=n.openid;storage.local.set("_openid",o),storage.local.set("_code",i),t()})):t()):(storage.local.remove("_openid"),clearCache(),void console.error("缺少code"))}function requireOpenIdFromMiniGame(t){platform.login().then(function(e){e.code?getOpenidByCode(e.code,function(i){var n=JSON.parse(i.message),o=n.openid;storage.local.set("_openid",o),storage.local.set("_code",e.code),t()}):Utils.toast("登录失败！"+e.errMsg)})}function requireOpenId(t){Utils.isMiniGame()?requireOpenIdFromMiniGame(t):requireOpenIdFromWeb(t)}function requireUserInfo(t){isCacheUseful("_user")?t():(debug("requireUserInfo..."),Http.get(URLObj.Config.urls.userinfo,{uname:URLObj.Config.uname,__openid:storage.local.get("_openid")}).then(function(e){storage.local.set("_user",e),storage.local.set("_sessionid",e.SESSIONID),t()})["catch"](function(t){456===t.status&&storage.local.clear()}))}function requireUserAuth(t,e){if(e&&storage.local.remove("_authToken"),isCacheUseful("_authToken"))t();else{debug("requireUserAuth...");var i=storage.local.get("_sessionid");Http.post(URLObj.Config.urls.authToken,{__sessionid:i}).then(function(e){if(0!==e.error){var i=storage.local.get("user")||{};Utils.toast("用户凭证获取出错 error:"+e.error+", userID:"+i.ID),debug(e.errorHint)}else storage.local.set("_authToken",e.authToken),t()},function(t){Utils.toast("用户凭证获取失败 status:"+t.status+", sessionid: "+i)})}}function refreshUserAuth(t){requireUserAuth(t,!0)}function clearCache(){storage.local.remove("_isFollowed"),storage.local.remove("_sessionid"),storage.local.remove("_user")}function debug(t){console.log(t)}function main(){URLObj.Config.useCache||clearCache(),requireOpenId(function(){isUserFollowed(function(t){t?requireUserInfo(function(){requireUserAuth(function(){gotoApp()})}):gotoApp()})})}function getKey(t){return void 0===t||null===t||""===t?t:STORAGE_KEY+":"+t}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(o,r){function s(t){try{h(n.next(t))}catch(e){r(e)}}function a(t){try{h(n["throw"](t))}catch(e){r(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,r&&(s=r[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,r=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(n){i=[6,n],r=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,r,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;n>i;i++){e=arguments[i];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},Utils=function(){function t(){}return t.createBitmapByName=function(t,e,i,n,o){void 0===e&&(e=0),void 0===i&&(i=0);var r=new egret.Bitmap,s=RES.getRes(t);return r.texture=s,r.x=e,r.y=i,void 0!==n&&(r.width=n),void 0!==o&&(r.height=o),r},t.extentP2=function(e){return e/t.factor},t.extentEC=function(e){return e*t.factor},t.getP2Pos=function(e,i){return[e/t.factor,i/t.factor]},t.getECPos=function(e,i){return[e*t.factor,i*t.factor]},t.range=function(t,e,i){void 0===i&&(i=!1);var n,o=t+Math.random()*(e-t);return n=i?Math.floor(o):o},t.getQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!==i?decodeURIComponent(i[2]):null},t.toast=function(t){wx.showToast?wx.showToast({title:t}):console.error(t)},t.isWeiXin=function(){var t=window.navigator.userAgent;return/MicroMessenger/.test(t)?!0:!1},t.isMiniGame=function(){var t=window.navigator.userAgent;return/MicroMessenger\/[\d.\d]+ MiniGame/.test(t)?!0:!1},t.factor=50,t}();__reflect(Utils.prototype,"Utils");var authReady=function(){},isUserFollowed=function(t){var e=storage.local.get("_user"),i=storage.local.get("_sessionid"),n=storage.local.get("_openid");e||i?t(!0):(debug("isUserFollowed..."),Http.post(URLObj.weixinapiURL,{type:"getWeixinUserInfo",uname:URLObj.Config.uname,param:n,__zaofans:!0}).then(function(e){var i=1===(e.data||{}).subscribe?!0:!1;i&&storage.local.set("_isFollowed",i),t(i)})["catch"](function(){t(!1)}))},auth={launch:function(){!Utils.isMiniGame()&&Utils.isWeiXin()&&"undefined"==typeof window.WeixinJSBridge?document.addEventListener("WeixinJSBridgeReady",function t(){main(),document.removeEventListener("WeixinJSBridgeReady",t,!1)},!1):main()},ready:function(t){authReady=t}},AwardItem=function(t){function e(e){var i=t.call(this)||this;return i.data=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=Utils.createBitmapByName("award_item_bg_png");this.addChild(e);var i=new egret.TextField;i.text=(this.data.params||{}).title,i.textColor=7744029,i.size=32,i.bold=!0,i.x=204,i.y=52,this.addChild(i)},e}(egret.Sprite);__reflect(AwardItem.prototype,"AwardItem");var Button=function(t){function e(e){var i=t.call(this)||this;return i.config=e,i.normalTexture=RES.getRes(e.normal.texture),i.activeTexture=RES.getRes(e.active.texture),i.texture=i.normalTexture,i.touchEnabled=!0,i.addEventListener(egret.TouchEvent.TOUCH_BEGIN,i.onTouchStart,i),i.addEventListener(egret.TouchEvent.TOUCH_END,i.onTouchEnd,i),i}return __extends(e,t),e.prototype.onTouchStart=function(t){this.texture=this.activeTexture},e.prototype.onTouchEnd=function(t){this.texture=this.normalTexture},e}(egret.Bitmap);__reflect(Button.prototype,"Button");var URLObj={urlHost:"http://{hostname}/zaofans_wheat",siloHost:"http://it.zaofans.com/silo/debug",shareUrl:"http://{hostname}/OrderUI-wheat/activity/activitys/annual-report",weixinapiURL:"http://{hostname}/weixin_wheat/open-api",weixinAuthUser:"https://open.weixin.qq.com/connect/oauth2/authorize?appid={appid}&redirect_uri=http%3A%2F%2F{hostname}%2FOrderUI-wheat%2Factivity%2Factivitys%2Fannual-report%2Findex.html?uname={uname}&response_type=code&scope=snsapi_base&state=123456#wechat_redirect",Config:{urls:{userinfo:"/usercenter/user/info",buyrecord:"/user/buy/record/get",shareReward:"/user/reward/share/151",authToken:"/silo/user/auth/create",sourceUrl:"http://edm.mcake.com/shuxy/2017/annual-report",shareIcon:"http://edm.mcake.com/shuxy/2017/annual-report/resource/assets/shareIcon.png"},uname:"zaofans",useCache:!0}};!function(){var t=!1,e=location.hostname,i=Utils.getQueryString("uname")||"zaofans";("localhost"===e||/^192\.168\.\d+\.\d+/.test(e))&&(e="www.zaofans.com",t=!0);var n={zaofans:"wxa3c1a88324d35d1f",wuhan:"wx904143829f0b0d1b",nanjing:"wx9746bb172d736a0c",dalian:"wx610b5c9cf75bdf07",qingdao:"wx74e5adac0bacd7c2",chongqing:"wx6d4e8be6afe3fac0",haerbin:"wx5645dcf6a81003e2",shenyang:"wxeccc20719c5cfc7e",tianjin:"wxbb9dc835c34e9918",gertz:"wxc97360c6205ff452",joyseed:"wxc61ea7696e402f22","default":"wxa3c1a88324d35d1f"};for(var o in URLObj)"string"==typeof URLObj[o]&&(URLObj[o]=URLObj[o].replace(/\{hostname\}/g,"www.zaofans.com").replace("{uname}",i).replace("{appid}",t?n["default"]:n[i]));URLObj.Config.uname=i;for(var r in URLObj.Config.urls)URLObj.Config.urls[r]=URLObj.urlHost+URLObj.Config.urls[r]}();var FailDlg=function(t){function e(e){void 0===e&&(e=[]);var i=t.call(this)||this;return i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e);var i=new egret.Sprite;i.x=70,i.y=406;var n=Utils.createBitmapByName("fail_bg_png");i.addChild(n),this.button=new egret.Shape,this.button.graphics.beginFill(0,0),this.button.graphics.drawRect(0,0,207,68),this.button.graphics.endFill(),this.button.y=430,this.button.x=204,this.button.touchEnabled=!0,i.addChild(this.button),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.dispatchEvent(new egret.Event("close"))},this),this.closeBtn=Utils.createBitmapByName("circle-close_png"),this.closeBtn.x=273,this.closeBtn.y=590,i.addChild(this.closeBtn),this.closeBtn.touchEnabled=!0,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.dispatchEvent(new egret.Event("close"))},this),i.addChild(n),this.addChild(i)},e}(egret.Sprite);__reflect(FailDlg.prototype,"FailDlg");var Game=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this)||this;return n.x=e,n.y=i,n.debug=!1,n.target=null,n.isCollision=!1,n._boxStack=[],n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){this.createWorldSystem(),this.addElements(),this.initEvents()},e.prototype.createWorldSystem=function(){this.world=new p2.World({gravity:[0,35]}),this.world.defaultContactMaterial.friction=.5,this.world.setGlobalStiffness(1e3)},e.prototype.addElements=function(){this.createGround(688,20,-20,750,"地面"),this.createGround(20,950,-20,-200,"左墙面"),this.createGround(20,950,648,-200,"右墙面"),this.hooker=new Hooker,this.addChild(this.hooker),this.reStart()},e.prototype.reStart=function(){var t=this;this.isCollision=!1,this.target=null,this.award=[],this.removeConstraint();var e=[{resId:"bread01_png",bundleId:"bread01"},{resId:"bread02_png",bundleId:"bread02"},{resId:"bread03_png",bundleId:"bread03"},{resId:"bread04_png",bundleId:"bread04"},{resId:"bread05_png",bundleId:"bread05"},{resId:"bread06_png",bundleId:"bread06"},{resId:"bread07_png",bundleId:"bread07"},{resId:"bread08_png",bundleId:"bread08"},{resId:"bread09_png",bundleId:"bread09"},{resId:"bread10_png",bundleId:"bread10"}];this.clearBodies(),e.forEach(function(e,i){setTimeout(function(){t._boxStack.push(t.createBread(e,Utils.range(100,500)))},100*i)}),setTimeout(function(){t.hooker.dispatchEvent(new egret.Event("reStartGame"))},2e3)},e.prototype.createConstraintBody=function(){var t=[[24,0],[35,8],[15,44],[19,73],[47,100],[38,110],[4,77],[0,42]],e=[[14,7],[24,0],[47,42],[47,76],[7,112],[0,100],[32,73],[33,45]];this.constraintBody||(this.constraintBody=this.createGround(50,10,120,350,"hit_body")),this.leftPaw=this.createPaw(t,113,258,"左臂"),this.rightPaw=this.createPaw(e,207,258,"右臂")},e.prototype.createGround=function(t,e,i,n,o){var r=new p2.Body({mass:1,position:Utils.getP2Pos(i+t/2,n+e/2),type:p2.Body.STATIC});r.displayName=o,this.world.addBody(r);var s=new p2.Box({width:Utils.extentP2(t),height:Utils.extentP2(e)});if(r.addShape(s),this.debug){var a=new egret.Shape;a.graphics.beginFill(0),a.graphics.drawRect(0,0,t,e),a.graphics.endFill(),a.x=a.width/2,a.y=a.height/2,a.anchorOffsetX=a.width/2,a.anchorOffsetY=a.height/2,r.displays=[a],this.addChild(a)}else r.displays=[];return r},e.prototype.createPaw=function(t,e,i,n){var o=new egret.Shape;o.graphics.beginFill(0),o.graphics.moveTo(t[0][0],t[0][1]),t.slice(1).forEach(function(t){o.graphics.lineTo(t[0],t[1])}),o.graphics.endFill(),o.x=e+o.width/2,o.y=i+o.height/2,o.anchorOffsetX=o.width/2,o.anchorOffsetY=o.height/2;var r=new p2.Body({mass:0,position:Utils.getP2Pos(e+o.width/2,i+o.height/2),type:p2.Body.STATIC}),s=t.map(function(t){return Utils.getP2Pos(t[0],t[1])});return r.displayName=n,r.fromPolygon(s),this.world.addBody(r),this.debug?(r.displays=[o],this.addChild(o)):r.displays=[],r},e.prototype.createBread=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=2);var n=Utils.createBitmapByName(t.resId);n.width=.6*n.width,n.height=.6*n.height;var o=-n.height;n.x=n.width/2,n.y=o+n.height/2,n.anchorOffsetX=n.width/2,n.anchorOffsetY=n.height/2;var r=new egret.Shape;r.graphics.beginFill(16711680),r.graphics.drawRect(0,0,n.width,n.height),r.graphics.endFill(),r.x=n.x,r.y=n.y,r.anchorOffsetX=n.width/2,r.anchorOffsetY=n.height/2;var s=new p2.Box({width:Utils.extentP2(n.width),height:Utils.extentP2(n.height)}),a=new p2.Body({mass:i,position:Utils.getP2Pos(e+n.width/2,o),angularVelocity:1,type:p2.Body.DYNAMIC});return a.displayName=t.resId,a.bundleId=t.bundleId,a.addShape(s),this.world.addBody(a),a.displays=[this.debug?r:n],this.addChild(this.debug?r:n),a},e.prototype.removePaws=function(){this.leftPaw&&this.world.removeBody(this.leftPaw),this.rightPaw&&this.world.removeBody(this.rightPaw),this.leftPaw=null,this.rightPaw=null},e.prototype.clearBodies=function(){var t=this;this.removePaws(),this.constraintBody&&(this.world.removeBody(this.constraintBody),this.constraintBody=null),this._boxStack.forEach(function(e){t.world.removeBody(e)}),this._boxStack=[]},e.prototype.updateDisplay=function(){var t=this.world.bodies.length,e=this.constraintBody,i=this.hooker,n=this.hooker.leftLeg,o=this.hooker.rightLeg,r=this.hooker.paws,s=this.leftPaw,a=this.rightPaw;e&&(e.position[0]=Utils.extentP2(i.x+87),e.position[1]=Utils.extentP2(r.y+295),s&&a&&(s.position[0]=Utils.extentP2(i.x+n.vx+n.vy+35),s.position[1]=Utils.extentP2(r.y+n.vy+320),a.position[0]=Utils.extentP2(i.x+o.vx+135),a.position[1]=Utils.extentP2(r.y+o.vy+320),s.angle=n.rotation/180*Math.PI,a.angle=o.rotation/180*Math.PI));for(var h=0;t>h;h++){var c=this.world.bodies[h],d=c.displays[0];d&&(d.x=Utils.extentEC(c.position[0]),d.y=Utils.extentEC(c.position[1]),d.rotation=180*c.angle/Math.PI,this.debug&&(c.sleepState===p2.Body.SLEEPING?d.alpha=.5:d.alpha=1))}},e.prototype.createConstraint=function(t){var e=this.constraintBody;this.mouseConstraint=new p2.RevoluteConstraint(e,t,{worldPivot:[e.position[0],e.position[1]]}),this.world.addConstraint(this.mouseConstraint)},e.prototype.removeConstraint=function(){this.world.removeConstraint(this.mouseConstraint),this.mouseConstraint=null},e.prototype.release=function(){this.removeConstraint(),this.removePaws()},e.prototype.showResult=function(t){t?console.log(t.displayName,t.bundleId):console.log("未抓到任何面包"),this.award.length>0?this.parent.showAward(this.award):this.parent.showFail()},e.prototype.getGameResult=function(t){return __awaiter(this,void 0,void 0,function(){var e,i=this;return __generator(this,function(n){switch(n.label){case 0:return[4,service.game.result(t?t.bundleId:"")];case 1:return e=n.sent(),this.award=e.income||[],this.hooker.goUp(),t&&0===this.award.length&&(Math.random()>.2?setTimeout(function(){i.release()},2500):this.release()),[2]}})})},e.prototype.initEvents=function(){var t=this,e=null;this.addEventListener(egret.Event.ENTER_FRAME,function(){this.world.step(1/60),this.updateDisplay()},this),this.addEventListener("startGame",function(t){this.hooker.goDown(),this.hooker.dispatchEvent(new egret.Event("startGame"))},this),this.world.on("impact",function(i){e=t.constraintBody,e&&(t.isCollision||i.bodyA!==e&&i.bodyB!==e||(t.isCollision=!0,t.target=i.bodyA===e?i.bodyB:i.bodyA,t.hooker.stop(),t.createConstraint(t.target),t.dispatchEvent(new egret.Event("catch")),console.log("hit -> "+t.target.displayName)))}),this.world.on("removeBody",function(e){for(var i=e.body.displays,n=0;n<i.length;n++)t.removeChild(i[n])}),this.addEventListener("catch",function(t){this.getGameResult(this.target)},this),this.hooker.addEventListener("godown",function(){this.createConstraintBody()},this),this.hooker.addEventListener("reachdown",function(){this.getGameResult(null)},this),this.hooker.addEventListener("goup",function(){this.removePaws(),setTimeout(this.createConstraintBody.bind(this),1e3)},this),this.hooker.addEventListener("reachup",function(){this.removePaws(),this.showResult(this.target),this.dispatchEvent(new egret.Event("reachup"))},this)},e}(egret.Sprite);__reflect(Game.prototype,"Game");var Hooker=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this)||this;return n.x=e,n.y=i,n._canMove=!1,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){this.paws=new egret.Sprite,this.leftLeg=Utils.createBitmapByName("left_leg_png"),this.rightLeg=Utils.createBitmapByName("right_leg_png"),this.leftLeg.x=13+this.leftLeg.width/2,this.leftLeg.y=254,this.leftLeg.anchorOffsetX=this.leftLeg.width/2,this.rightLeg.x=113+this.rightLeg.width/2,this.rightLeg.y=254,this.rightLeg.anchorOffsetX=this.rightLeg.width/2,this.leftLeg.vx=0,this.leftLeg.vy=0,this.rightLeg.vx=0,this.rightLeg.vy=0,this.paws.addChild(this.leftLeg),this.paws.addChild(this.rightLeg),this.paws.addChild(Utils.createBitmapByName("machine_02_png",23,-400)),this.addChild(this.paws),this.addChild(Utils.createBitmapByName("machine_top_png")),this.initEvents()},e.prototype.goDown=function(){var t=this;this.dispatchEvent(new egret.Event("godown")),egret.Tween.get(this.paws).to({y:380},3e3).call(function(){t.dispatchEvent(new egret.Event("reachdown"))}),this.openLegs()},e.prototype.goUp=function(){var t=this;this.dispatchEvent(new egret.Event("close")),this.closeLegs(function(){t.dispatchEvent(new egret.Event("goup")),egret.Tween.get(t.paws).to({y:0},3e3).wait(300).call(function(){t.dispatchEvent(new egret.Event("reachup"))})})},e.prototype.stop=function(){egret.Tween.removeTweens(this.paws)},e.prototype.openLegs=function(){egret.Tween.get(this.leftLeg).to({vx:-30,rotation:30},1200),egret.Tween.get(this.rightLeg).to({vx:30,vy:-25,rotation:-27},1200)},e.prototype.closeLegs=function(t){egret.Tween.get(this.leftLeg).to({vx:0,rotation:0},1200),egret.Tween.get(this.rightLeg).to({vx:0,vy:0,rotation:0},1200).call(t,this)},e.prototype.disable=function(){this._canMove=!1},e.prototype.enable=function(){this._canMove=!0},e.prototype.initEvents=function(){var t=this,e=!0;this.addEventListener(egret.Event.ENTER_FRAME,function(){this._canMove&&(e&&(this.x+=2),e||(this.x-=2),this.x>482&&(e=!1,this.x=482),this.x<=0&&(e=!0,this.x=0))},this),this.addEventListener("startGame",function(e){t.disable()},this),this.addEventListener("reStartGame",function(e){t.enable()},this)},e}(egret.Sprite);__reflect(Hooker.prototype,"Hooker");var Http=function(){function t(){}return t.prototype.request=function(t){var e=this;return new Promise(function(i,n){var o=new egret.HttpRequest;t.headers=__assign({"Content-Type":"application/x-www-form-urlencoded"},t.headers),t=__assign({method:"GET",processData:!0,dataType:"json"},t);var r=t.method.toLocaleLowerCase(),s="get"===r?"?"+e._parseData(t.data,!0):"";o.responseType=egret.HttpResponseType.TEXT,o.open(t.url+s,"get"===r?egret.HttpMethod.GET:egret.HttpMethod.POST);for(var a in t.headers)o.setRequestHeader(a,t.headers[a]);o.send("get"===r?null:e._parseData(t.data,t.processData)),o.addEventListener(egret.Event.COMPLETE,function(e){var n=e.currentTarget;i("json"===t.dataType?JSON.parse(n.response):n.response)},e),o.addEventListener(egret.IOErrorEvent.IO_ERROR,function(t){n(t.currentTarget)},e)})},t.prototype._parseData=function(t,e){if(void 0===t&&(t={}),!e)return JSON.stringify(t);var i=[];for(var n in t)i.push(n+"="+t[n]);return i.join("&")},t.get=function(e,i,n){return(new t).request(__assign({url:e,method:"GET",data:i},n))},t.post=function(e,i,n){return(new t).request(__assign({url:e,method:"POST",data:i},n))},t}();__reflect(Http.prototype,"Http");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.createView()},e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField);var t=this.stage.stageWidth,e=this.stage.stageHeight;this.textField.width=480,this.textField.height=100,this.textField.x=(t-this.textField.width)/2,this.textField.y=(e-this.textField.height)/2,this.textField.textAlign="center"},e.prototype.onProgress=function(t,e){this.textField.text="Loading..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var AwardDlg=function(t){function e(e){void 0===e&&(e=[]);var i=t.call(this)||this;return i.dataList=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e);var i=new egret.Sprite;i.x=40,i.y=150;var n=Utils.createBitmapByName("award_bg_png");i.addChild(n),this.hint=new egret.TextField,this.hint.text="你可在个人中心-卡包中查看",this.hint.textColor=3355443,this.hint.size=26,this.hint.x=164,this.hint.y=622,i.addChild(this.hint),this.button=new egret.Shape,this.button.graphics.beginFill(0,0),this.button.graphics.drawRect(0,0,208,68),this.button.graphics.endFill(),this.button.y=704,this.button.x=228,this.button.touchEnabled=!0,i.addChild(this.button),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.dispatchEvent(new egret.Event("close"))},this),this.scrollView=new egret.ScrollView,this.scrollView.y=425,this.scrollView.x=95,this.scrollView.width=474,this.scrollView.height=260,i.addChild(this.scrollView),this.addChild(i)},e.prototype.setData=function(t){this.dataList=t,this.setScrollViewContent()},e.prototype.setScrollViewContent=function(){this.scrollView.removeContent(),this.scrollView.y=1===this.dataList.length?425:375,this.hint.y=1===this.dataList.length?622:657;var t=new egret.Sprite;this.dataList.forEach(function(e,i){var n=new AwardItem(e);n.y=181*i,t.addChild(n)}),this.scrollView.setContent(t)},e}(egret.Sprite);__reflect(AwardDlg.prototype,"AwardDlg");var Noticer=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this)||this;return n.x=e,n.y=i,n.addEventListener(egret.Event.ADDED_TO_STAGE,n.onAddToStage,n),n}return __extends(e,t),e.prototype.onAddToStage=function(t){this.noticeText=new egret.TextField,this.noticeText.text="",this.noticeText.size=35,this.noticeText.width=580,this.noticeText.textAlign="center",this.noticeText.textColor=16777215,this.addChild(this.noticeText)},e.prototype.startChange=function(t){var e=this,i=this.noticeText,n=-1,o=function(){n++,n>=t.length&&(n=0);var r=t[n];i.text=r;var s=egret.Tween.get(i);s.to({alpha:1},200),s.wait(2e3),s.to({alpha:0},200),s.call(o,e)};o()},e}(egret.Sprite);__reflect(Noticer.prototype,"Noticer");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var PointDlg=function(t){function e(e){void 0===e&&(e=[]);var i=t.call(this)||this;return i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e);var i=new egret.Sprite;i.x=70,i.y=406;var n=Utils.createBitmapByName("point_bg_png");i.addChild(n),this.button=new egret.Shape,this.button.graphics.beginFill(0,0),this.button.graphics.drawRect(0,0,207,68),this.button.graphics.endFill(),this.button.y=430,this.button.x=204,this.button.touchEnabled=!0,i.addChild(this.button),this.button.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.dispatchEvent(new egret.Event("close"))},this),this.closeBtn=Utils.createBitmapByName("circle-close_png"),this.closeBtn.x=273,this.closeBtn.y=590,i.addChild(this.closeBtn),this.closeBtn.touchEnabled=!0,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.dispatchEvent(new egret.Event("close"))},this),i.addChild(n),this.addChild(i)},e}(egret.Sprite);__reflect(PointDlg.prototype,"PointDlg");var PrizeDlg=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e);var i=new egret.Sprite;i.x=70,i.y=406;var n=Utils.createBitmapByName("price_bg_png");i.addChild(n),this.closeBtn=Utils.createBitmapByName("circle-close_png"),this.closeBtn.x=273,this.closeBtn.y=590,i.addChild(this.closeBtn),this.closeBtn.touchEnabled=!0,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.visible=!1},this),i.addChild(n),this.scrollView=new egret.ScrollView,this.scrollView.y=154,this.scrollView.x=90,this.scrollView.width=466,this.scrollView.height=300,i.addChild(this.scrollView),this.addChild(i)},e.prototype.setData=function(t){this.dataList=t,this.setScrollViewContent()},e.prototype.setScrollViewContent=function(){var t=new egret.Sprite;this.dataList.forEach(function(e,i){var n=new PrizeItem(e);n.y=110*i,t.addChild(n)}),this.scrollView.setContent(t)},e}(egret.Sprite);__reflect(PrizeDlg.prototype,"PrizeDlg");var PrizeItem=function(t){function e(e){var i=t.call(this)||this;return i.data=e,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=Utils.createBitmapByName(this.data.key+"_png");e.width*=.5,e.height*=.5,e.x=15,e.y=23,this.addChild(e);var i=new egret.TextField;i.text=this.data.title,i.textColor=3355443,i.size=28,i.x=165,i.y=53,this.addChild(i);var n=new egret.Shape;n.graphics.beginFill(14540253),n.graphics.drawRect(0,0,466,2),n.graphics.endFill(),n.y=120,this.addChild(n)},e}(egret.Sprite);__reflect(PrizeItem.prototype,"PrizeItem");var RuleDlg=function(t){function e(e){void 0===e&&(e=[]);var i=t.call(this)||this;return i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=new egret.Shape;e.graphics.beginFill(0,.8),e.graphics.drawRect(0,0,this.stage.stageWidth,this.stage.stageHeight),e.graphics.endFill(),this.addChild(e);var i=new egret.Sprite;i.x=70,i.y=406;var n=Utils.createBitmapByName("rule_bg_png");i.addChild(n),this.closeBtn=Utils.createBitmapByName("circle-close_png"),this.closeBtn.x=273,this.closeBtn.y=590,i.addChild(this.closeBtn),this.closeBtn.touchEnabled=!0,this.closeBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.parent.removeChild(this)},this),i.addChild(n);var o=new egret.TextField;o.text="抓面包机规则",o.size=32,o.x=202,o.y=53,o.textColor=3355443,i.addChild(o);var r=new egret.TextField;r.text="1、每次抓取消耗1次数，当次数不足时消耗2000麦点；\n2、按下开始按键后，爪子会自动左右移动，直到按下抓取按键；\n3、抓取按键被按下后，游戏次数将被消耗；\n4、当爪子抓取后，伸回原来的位置时，爪子上仍抓着面包，则抓取成功；\n5、抓取成功后，根据所抓面包来获得对应的奖励，具体信息可查看“奖励列表”；\n6、普通会员每天可获得一次免费抓取，金麦会员每天可获得两次免费抓取；",r.size=26,r.multiline=!0,r.width=520,r.lineSpacing=20,r.textColor=8355711,this.scrollView=new egret.ScrollView,this.scrollView.y=134,this.scrollView.x=55,this.scrollView.width=r.width,this.scrollView.height=320,this.scrollView.setContent(r),i.addChild(this.scrollView),this.addChild(i)},e}(egret.Sprite);__reflect(RuleDlg.prototype,"RuleDlg");var URL_HOST="https://dev.withwheat.wang/silo/h5/",count=0,service;!function(t){var e=function(){function t(){}return t.doRequest=function(e,i,o,r){Http.post(""+URL_HOST+e+".json",__assign({auth:n.getAuthToken()},i),{processData:!1}).then(function(n){if(0===n.protocError)o(n);else if(n.protocError>700&&n.protocError<800)refreshUserAuth(function(){t.doRequest(e,i,o,r)});else{var s=n.errorHint||"未知错误("+n.protocError+")";r(s),Utils.toast(s)}})["catch"](function(t){var e="网络请求错误";r(e),Utils.toast(e)})},t.request=function(e,i){return new Promise(function(n,o){t.doRequest(e,i,n,o)})},t}();t.common=e,__reflect(e.prototype,"service.common");var i=function(){function t(){}return t.drop=function(){return e.request("/asset/drop/2205",{dropKey:"drop-free-game-ticket"})},t.remain=function(){return e.request("/asset/remain/2211",{dropKey:"drop-free-game-ticket"})},t.exchange=function(){return e.request("/asset/exchange/2213",{exchange:"point-to-game-ticket"})},t}();t.asset=i,__reflect(i.prototype,"service.asset");var n=function(){function t(){}return t.getAuthToken=function(){return storage.local.get("_authToken")},t}();t.user=n,__reflect(n.prototype,"service.user");var o=function(){function t(){}return t.result=function(t){return e.request("/game/result/2215",{game:"51021",params:{option:t}})},t.config=function(){return e.request("/game/config/2219",{game:"51021"})},t.log=function(){return e.request("/game/config/2217",{game:"51021"})},t}();t.game=o,__reflect(o.prototype,"service.game")}(service||(service={}));var isLocalStorageSupported=function(){var t="test",e=window.localStorage;try{return e.setItem(t,"1"),e.removeItem(t),!0}catch(i){return!1}}(),STORAGE_KEY=Utils.getQueryString("uname")||window.localStorage.getItem("wx_uname")||"zaofans",decode=function(t){return unRfc2068(decodeURIComponent(t.replace(/\+/g," ")))},unRfc2068=function(t){return 0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),t},Cookie={defaults:{path:"/"},set:function(t,e,i,n,o,r){if(void 0!==e){var s={expires:i,path:n,domain:o,secure:r};if(t=getKey(t),s=__assign({},this.defaults,s),(null===e||""===e)&&(s.expires=-1),"number"==typeof s.expires){var a=s.expires,h=s.expires=new Date;h.setDate(h.getDate()+a)}e="object"==typeof e?JSON.stringify(e):e,document.cookie=[encodeURIComponent(t),"=",encodeURIComponent(e),s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}},get:function(t){var e,i,n,o=document.cookie.split("; "),r=t?null:{};t=getKey(t);for(var s=0,a=o.length;a>s;s++){if(e=o[s].split("="),i=decode(e.shift()),n=decode(e.join("=")),t&&t===i){r=n;break}t||(r[i]=n)}return r},remove:function(t){if(t=getKey(t),null!==this.get(t)){var e=[].slice.call(arguments,1);e.unshift(t,null),this.set.apply(this,e)}},clear:function(t){var e=document.cookie.match(/[^ =;]+(?=\=)/g);if(e)for(var i=e.length;i--;)(t||decode(e[i]).split(":")[0]===STORAGE_KEY)&&(document.cookie=e[i]+"=0;expires="+new Date(0).toUTCString())},length:function(t){if(t)return document.cookie.length;var e=document.cookie.match(/[^ =;]+(?=\=)/g);return e.filter(function(t){return decode(t).split(":")[0]===STORAGE_KEY}).length}},LocalStorage={set:function(t,e){"object"==typeof e&&(e=JSON.stringify(e)),isLocalStorageSupported?(t=getKey(t),window.localStorage.setItem(t,encodeURIComponent(e))):Cookie.set(t,e,3650)},get:function(t){var e="";isLocalStorageSupported?(t=getKey(t),e=decodeURIComponent(window.localStorage.getItem(t))):e=JSON.stringify(Cookie.get(t));
try{return JSON.parse(e)}catch(i){return e}},remove:function(t){isLocalStorageSupported?(t=getKey(t),window.localStorage.removeItem(t)):Cookie.remove(t)},clear:function(t){isLocalStorageSupported?t?window.localStorage.clear():Object.keys(window.localStorage).forEach(function(t){t.split(":")[0]===STORAGE_KEY&&window.localStorage.removeItem(t)}):Cookie.clear(t)},length:function(t){return t?window.localStorage.length:Object.keys(window.localStorage).filter(function(t){return t.split(":")[0]===STORAGE_KEY}).length}},SessionStorage={set:function(t,e){"object"==typeof e&&(e=JSON.stringify(e)),isLocalStorageSupported?(t=getKey(t),window.sessionStorage.setItem(t,encodeURIComponent(e))):Cookie.set(t,e)},get:function(t){var e="";isLocalStorageSupported?(t=getKey(t),e=decodeURIComponent(window.sessionStorage.getItem(t))):e=JSON.stringify(Cookie.get(t));try{return JSON.parse(e)}catch(i){return e}},remove:function(t){isLocalStorageSupported?(t=getKey(t),window.sessionStorage.removeItem(t)):Cookie.remove(t)},clear:function(t){isLocalStorageSupported?t?window.sessionStorage.clear():Object.keys(window.sessionStorage).forEach(function(t){t.split(":")[0]===STORAGE_KEY&&window.sessionStorage.removeItem(t)}):Cookie.clear(t)},length:function(t){return t?window.sessionStorage.length:Object.keys(window.sessionStorage).filter(function(t){return t.split(":")[0]===STORAGE_KEY}).length}},storage={cookie:Cookie,local:LocalStorage,session:SessionStorage},Timer=function(t){function e(e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=t.call(this)||this;return n.x=e,n.y=i,n.count=0,n._countText=new egret.TextField,n._countText.textColor=16777215,n._countText.text="剩余:"+n.count+"次",n._countText.size=26,n.addChild(n._countText),n}return __extends(e,t),e.prototype.setCount=function(t){this.count=t,this._countText.text="剩余:"+this.count+"次"},e}(egret.Sprite);__reflect(Timer.prototype,"Timer");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){var e=this;egret.lifecycle.addLifecycleListener(function(t){t.onUpdate=function(){}}),egret.lifecycle.onPause=function(){egret.ticker.pause()},egret.lifecycle.onResume=function(){egret.ticker.resume()},this._openid=Utils.getQueryString("openid"),this.wxShare(),auth.launch(),auth.ready(function(){e.AuthReady()})},e.prototype.AuthReady=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return service.asset.drop(),[4,service.asset.remain()];case 1:return t=e.sent(),this.remainAmount=this._getGameAmount(t.remain),this.runGame()["catch"](function(t){console.log(t)}),[2]}})})},e.prototype._getGameAmount=function(t){var e=t.filter(function(t){return"GameTicket#24001"===t.config});return e.length?e[0].amount:0},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){var t;return __generator(this,function(e){switch(e.label){case 0:return[4,this.loadResource()];case 1:return e.sent(),this.createGameScene(),[4,service.game.log()];case 2:return t=e.sent(),this.noticer.startChange(this._genNoticeData(t.income)),[2]}})})},e.prototype._genNoticeData=function(t){return t.map(function(t){return t.params.nick+"获得"+t.params.title+" x "+t.amount})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),t=new LoadingUI,this.stage.addChild(t),[4,RES.loadConfig("resource/default.res.json","resource/")];case 1:return i.sent(),[4,RES.loadGroup("preload",0,t)];case 2:return i.sent(),this.stage.removeChild(t),[3,4];case 3:return e=i.sent(),console.error(e),[3,4];case 4:return[2]}})})},e.prototype.getOpenid=function(){return this._openid||storage.local.get("_openid")},e.prototype.wxShare=function(){Utils.isMiniGame()||(weixinApiService.authorize(),weixinApiService.exec("onMenuShareTimeline",{title:"原麦山丘四周年，邀你一起领福利！",link:URLObj.shareUrl+"/share.html?uname="+URLObj.Config.uname+"&openid="+this.getOpenid(),imgUrl:URLObj.Config.urls.shareIcon,success:function(t){},cancel:function(){},fail:function(t){console.info("fail"+JSON.stringify(t))}}),weixinApiService.exec("onMenuShareAppMessage",{title:"原麦山丘四周年，邀你一起领福利！",desc:"这台时光机，只想与你分享！",link:URLObj.shareUrl+"/share.html?uname="+URLObj.Config.uname+"&openid="+this.getOpenid(),imgUrl:URLObj.Config.urls.shareIcon,success:function(){},cancel:function(){}}))},e.prototype.showAward=function(t){this.setChildIndex(this.awardDlg,100),this.awardDlg.setData(t),this.awardDlg.visible=!0},e.prototype.hideAward=function(){this.awardDlg.visible=!1},e.prototype.showFail=function(){this.setChildIndex(this.failDlg,100),this.failDlg.visible=!0},e.prototype.hideFail=function(){this.failDlg.visible=!1},e.prototype.showPoint=function(){this.setChildIndex(this.pointDlg,100),this.pointDlg.visible=!0},e.prototype.hidePoint=function(){this.pointDlg.visible=!1},e.prototype.showRule=function(){var t=new RuleDlg;this.addChild(t)},e.prototype.showPrizes=function(){var t=this;this.prizeDlg?this.prizeDlg.visible=!0:(this.giftBtn.touchEnabled=!1,service.game.config().then(function(e){t.giftBtn.touchEnabled=!0,t.prizeDlg=new PrizeDlg,t.addChild(t.prizeDlg),t.prizeDlg.setData(t._genPrizeData(e.income))}))},e.prototype.createGameScene=function(){this.addElements(),this.createButton(),this.initEvents()},e.prototype.addElements=function(){this.addChild(Utils.createBitmapByName("bg_jpg",0,0,this.stage.stageWidth,this.stage.stageHeight)),this.addChild(Utils.createBitmapByName("main_title_png",225,156)),this.ruleBtn=Utils.createBitmapByName("rule_btn_png",0,113),this.addChild(this.ruleBtn),this.ruleBtn.touchEnabled=!0,this.ruleBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showRule()},this),this.giftBtn=Utils.createBitmapByName("gift_btn_png",648,106),this.addChild(this.giftBtn),this.giftBtn.touchEnabled=!0,this.giftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.showPrizes()},this),this.noticer=new Noticer(90,276),this.addChild(this.noticer),this.timer=new Timer(582,1216),this.timer.setCount(this.remainAmount),this.addChild(this.timer),this.game=new Game(50,368);var t=new egret.Rectangle(-50,0,this.stage.stageWidth,765);this.game.mask=t,this.addChild(this.game),this.addChild(Utils.createBitmapByName("top_roof_png",0,196)),this.awardDlg=new AwardDlg,this.awardDlg.visible=!1,this.addChild(this.awardDlg),this.failDlg=new FailDlg,this.failDlg.visible=!1,this.addChild(this.failDlg),this.pointDlg=new PointDlg,this.pointDlg.visible=!1,this.addChild(this.pointDlg)},e.prototype._genPrizeData=function(t){var e=[];return Object.keys(t).forEach(function(i){e.push({key:i,title:t[i][0].params.title})}),e},e.prototype.createButton=function(){this.startButton=new Button({normal:{texture:"button_go_png"},active:{texture:"button_go_0_png"}}),this.startButton.x=213,this.startButton.y=1162,this.addChild(this.startButton)},e.prototype.initEvents=function(){this.startButton.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.remainAmount>0?this.game.dispatchEvent(new egret.Event("startGame")):this.showPoint(),this.startButton.touchEnabled=!1},this),this.game.addEventListener("reachup",function(t){this.remainAmount=Math.max(0,--this.remainAmount),this.timer.setCount(this.remainAmount)},this),this.awardDlg.addEventListener("close",function(t){this.hideAward(),this.startButton.touchEnabled=!0,this.game.reStart()},this),this.failDlg.addEventListener("close",function(t){this.hideFail(),this.startButton.touchEnabled=!0,this.game.reStart()},this),this.pointDlg.addEventListener("close",function(t){var e=this;service.asset.exchange().then(function(t){e.remainAmount=e._getGameAmount(t.income),e.remainAmount>0?(e.hidePoint(),e.timer.setCount(e.remainAmount),e.startButton.touchEnabled=!0,e.game.reStart()):Utils.toast("您当前积分不足，请去商城购物或者通过其它方式获取更多积分")})},this),document.addEventListener("touchstart",function(t){t.preventDefault()},!1)},e}(egret.DisplayObjectContainer);__reflect(Main.prototype,"Main");